<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Happy Wedding Day!</title>
  <style>
    body {
    	background-image: url('forest.jpg');
    	background-repeat: no-repeat;
    	background-size: 100% auto;
      overflow: hidden;
    }

    .demo-dot {
     position: absolute;
   }

   .demo-dot::after {
     content: '';
     display: block;
     width: 40px;
     height: 40px;
     border-radius: 20px;
     background-image: radial-gradient(1px at 20px 50% , rgba(255,153,0, 1), rgba(255,255, 0, 0.4), rgba(255, 255, 0, 0) 22px)
   }
 </style>
</head>
<body>
 <div id="holder">
  <div class="demo-dot"></div>
  <div class="demo-dot"></div>
  <div class="demo-dot"></div>
</div>
</body>
<script>
  // Original JavaScript code by Chirp Internet: www.chirp.com.au
// Please acknowledge use of this code by including this header.

(function() {

  function rando_style() {
    var styles = ["bezier", "circle", "lemniscate"];
    return styles[Math.floor(Math.random()*styles.length)];
  }


  function rando_num(min, max) {
    return Math.random() * (max - min) + min;
  }

  window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

  var fairy = document.getElementsByClassName("demo-dot");
  var fairylist = [];
  for(var i = 0; i < fairy.length; i++) {
    fairylist.push({
      fairy: fairy[i], 
      R: 50+(Math.random()* 300),
      time:  (Math.random() * 150),
      x: (Math.random() * window.innerWidth),
      y: (Math.random() * window.innerHeight/2),
      blink: false,
      fade: false,
      change_r: Math.round(Math.random()),
      circle: Math.round(Math.random()) === 1 ? true : false,
      circle_speed: Math.round(Math.random()*3),
      circle_angle: Math.round(Math.random()*360),
      bezier: Math.round(Math.random()) === 1 ? true: false,
      animation_style: rando_style()
    });
  }
  console.log(fairylist);

  var duration = 10; // seconds

  var start = null;

//make different fairies on different patterns

function update_variation() {
  // x = 1 + Math.floor((Math.random() * 3));
  // lets them randomly teleport - not sure if desired until we see a bunch on screen
  // t += Math.floor((Math.random() * 1.003));
  //increase or decrease R
  //make sure to decrease or reset after a threshold - it getting larger will makei t go 'faster'
  //550 is a good stop - some percent of the screen?
  //currently going to get stuck between those very quickly V
  if(R <= cx/2) {
    // console.log("here");
    R += Math.floor((Math.random() * 1.1));
  } else {
    // console.log("no here");
    R -= Math.floor((Math.random() * 1.1));
  }
  // console.log(R);
}

function step(timestamp)
{
  if(start === null) {
    start = timestamp;
    stretchFactor = 1 + (Math.random() * 3);
  }
  for(var j = 0; j < fairylist.length; j++) {
    fairylist[j].time += 0.05+(Math.random() * 0.03);

    cx = fairylist[j].x;
    cy = fairylist[j].y;

    if(fairylist[j].animation_style == "circle") {
      fairylist[j].circle_angle+=fairylist[j].circle_speed;
      if (fairylist[j].circle_angle>360) fairylist[j].circle_angle = 0;
      x = cx + fairylist[j].R * Math.cos(fairylist[j].circle_angle * Math.PI / 180);
      y = cy + fairylist[j].R * Math.sin(fairylist[j].circle_angle * Math.PI / 180);
    } else if(fairylist[j].animation_style == "lemniscate") {

      if(fairylist[j].change_r == 1) {
        if (fairylist[j].R < 300) {
          fairylist[j].R += 1+(Math.random()*10);
        }
      }

      x = cx + fairylist[j].R * Math.cos(fairylist[j].time);
      y = cy + fairylist[j].R * Math.sin(fairylist[j].time) * Math.cos(fairylist[j].time);

    } else if(fairylist[j].animation_style == "bezier") {

      if(start === null) start = timestamp;

      var progress = (timestamp - start) / duration / 1000;
          x = progress * (window.innerWidth*3) / (window.innerWidth/20); // x = ƒ(t)
          y = 8 * Math.sin(x); // y = ƒ(x)
          if(x>window.innerWidth) {
            x = 0;
          }
          if(progress >= 1) start = null;

        }
        fairylist[j].fairy.style.left = x+"px";
        fairylist[j].fairy.style.bottom = y+"px";
      }
      requestAnimationFrame(step);
    }
// setInterval(update_variation(variation), 1000);

requestAnimationFrame(step);

})();
</script>
</html>